<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste localStorage</title>
</head>
<body>
    <h1>Teste localStorage</h1>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="testUpload()">Testar Upload</button>
    <button onclick="testGetPhotos()">Ver Fotos</button>
    <button onclick="clearStorage()">Limpar Storage</button>
    <div id="result"></div>

    <script>
        // Simula√ß√£o do localStorage.ts
        class LocalStorageDB {
            getStorageKey(key) {
                return `guapa_${key}`
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2)
            }

            async getHomePhotos() {
                try {
                    const photos = localStorage.getItem(this.getStorageKey('home_photos'))
                    return photos ? JSON.parse(photos) : []
                } catch (error) {
                    console.error('Erro ao buscar fotos da home:', error)
                    return []
                }
            }

            async addHomePhoto(imageUrl) {
                try {
                    const photos = await this.getHomePhotos()
                    const newPhoto = {
                        id: this.generateId(),
                        imageUrl,
                        order: photos.length + 1,
                        isActive: true,
                        createdAt: new Date().toISOString()
                    }
                    
                    photos.push(newPhoto)
                    localStorage.setItem(this.getStorageKey('home_photos'), JSON.stringify(photos))
                    return newPhoto
                } catch (error) {
                    console.error('Erro ao adicionar foto:', error)
                    throw error
                }
            }
        }

        const localDB = new LocalStorageDB()

        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader()
                reader.onload = () => {
                    const base64 = reader.result
                    resolve(base64)
                }
                reader.onerror = () => {
                    reject(new Error('Erro ao ler arquivo'))
                }
                reader.readAsDataURL(file)
            })
        }

        async function testUpload() {
            const fileInput = document.getElementById('fileInput')
            const file = fileInput.files[0]
            
            if (!file) {
                alert('Selecione um arquivo primeiro!')
                return
            }

            try {
                console.log('Iniciando upload de:', file.name, 'tamanho:', file.size, 'tipo:', file.type)
                
                if (!file.type.startsWith('image/')) {
                    throw new Error('O arquivo deve ser uma imagem')
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    throw new Error('O arquivo deve ter no m√°ximo 5MB')
                }

                const imageUrl = await convertToBase64(file)
                console.log('Imagem convertida para base64 com sucesso')

                const newPhoto = await localDB.addHomePhoto(imageUrl)
                console.log('Foto adicionada com sucesso:', newPhoto)
                
                document.getElementById('result').innerHTML = `
                    <h3>‚úÖ Upload realizado com sucesso!</h3>
                    <p>ID: ${newPhoto.id}</p>
                    <p>Ordem: ${newPhoto.order}</p>
                    <p>Criado em: ${newPhoto.createdAt}</p>
                    <img src="${newPhoto.imageUrl}" style="max-width: 200px; max-height: 200px;" />
                `
            } catch (error) {
                console.error('Erro no upload:', error)
                document.getElementById('result').innerHTML = `
                    <h3>‚ùå Erro no upload:</h3>
                    <p>${error.message}</p>
                `
            }
        }

        async function testGetPhotos() {
            try {
                const photos = await localDB.getHomePhotos()
                console.log('Fotos encontradas:', photos)
                
                let html = '<h3>üì∏ Fotos no localStorage:</h3>'
                if (photos.length === 0) {
                    html += '<p>Nenhuma foto encontrada</p>'
                } else {
                    photos.forEach(photo => {
                        html += `
                            <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                                <p><strong>ID:</strong> ${photo.id}</p>
                                <p><strong>Ordem:</strong> ${photo.order}</p>
                                <p><strong>Ativo:</strong> ${photo.isActive}</p>
                                <p><strong>Criado em:</strong> ${photo.createdAt}</p>
                                <img src="${photo.imageUrl}" style="max-width: 150px; max-height: 150px;" />
                            </div>
                        `
                    })
                }
                
                document.getElementById('result').innerHTML = html
            } catch (error) {
                console.error('Erro ao buscar fotos:', error)
                document.getElementById('result').innerHTML = `
                    <h3>‚ùå Erro ao buscar fotos:</h3>
                    <p>${error.message}</p>
                `
            }
        }

        function clearStorage() {
            localStorage.removeItem('guapa_home_photos')
            document.getElementById('result').innerHTML = '<h3>üóëÔ∏è Storage limpo!</h3>'
        }
    </script>
</body>
</html>
